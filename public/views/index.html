<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../stylesheets/style.css" />

    <title>Todoアプリ</title>
  </head>
  <body>
    <div class="container">
      <!-- Content here -->
      <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#add">
        <b>＋タスクを追加</b>
      </button>
      <ul id="list-group" class="list-group">
        <li class="list-group-item category c1"> <!--class list-group-item category-orange-->
          <div class="row align-items-center">
            <span class="col-sm-8">タスク1が入る　緑は生活</span><span class="col-sm-2" >2222年 22月 22日</span>  
            <div class="btn-group" role="group" aria-label="Basic example" class="col-sm-2">
              <button type="button" class="btn btn-primary update" data-toggle="modal" data-target="#update">更新</button>
              <button type="button" class="btn btn-danger">削除</button>
            </div>
          </div>
        </li>
        <li class="list-group-item category c2"> <!--class list-group-item category-orange-->
          <div class="row align-items-center">
            <span class="col-sm-8">タスク2が入る　オレンジは勉強</span><span class="col-sm-2" >2222年 22月 22日</span>  
            <div class="btn-group" role="group" aria-label="Basic example" class="col-sm-2">
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update">更新</button>
              <button type="button" class="btn btn-danger">削除</button>
            </div>
          </div>
        </li>
        <li class="list-group-item category c3"> <!--class list-group-item category-orange-->
          <div class="row align-items-center">
            <span class="col-sm-8">タスク3が入る　青は仕事</span><span class="col-sm-2" >2222年 22月 22日</span>  
            <div class="btn-group" role="group" aria-label="Basic example" class="col-sm-2">
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update">更新</button>
              <button type="button" class="btn btn-danger">削除</button>
            </div>
          </div>
        </li>
        <li class="list-group-item category c4 deadline" value="bye"> <!--class list-group-item category-orange-->
          <div class="row align-items-center">
            <span class="col-sm-8 task">タスク4が入る　ピンクは趣味</span><span class="col-sm-2" >2222年 22月 22日</span>  
            <div class="btn-group" role="group" aria-label="Basic example" class="col-sm-2">
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#update">更新</button>
              <button type="button" class="btn btn-danger">削除</button>
            </div>
          </div>
        </li>
      </ul>
    </div>
      
    <div class="modal fade" id="add" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">タスク登録</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <from>
              <div class="form-group">
                <label>タスク名</label>
                <input type="text" name="task" class="form-control">
              </div>
              <div class="form-group">
                <label>期限</label>
                <input type="date" name="deadline" class="form-control" class="date">
              </div>
              <div class="form-group">
                <label>カテゴリ</label>
                <select name="category" class="form-control">
                  <option value="1">生活</option>
                  <option value="2">勉強</option>
                  <option value="3">仕事</option>
                  <option value="4">趣味</option>
                  <!-- <option>※自分でカテゴリ追加できたらいいな※</option> -->
                </select>
              </div>
            </from>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">キャンセル</button>
            <button type="button" class="btn btn-primary" id="create-task" onclick="window.location.reload();">保存</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="update" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">タスク更新</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <from>
              <div class="form-group">
                <label>タスク名</label>
                <input type="text" name="task" class="form-control" id="update-task">
              </div>
              <div class="form-group">
                <label>期限</label>
                <input type="date" name="deadline" class="form-control date">
              </div>
              <div class="form-group">
                <label>カテゴリ</label>
                <select name="category" class="form-control">
                  <option value="1">生活</option>
                  <option value="2">勉強</option>
                  <option value="3">仕事</option>
                  <option value="4">趣味</option>
                  <!-- <option>※自分でカテゴリ追加できたらいいな※</option> -->
                </select>
              </div>
              <div class="form-group">
                <label>ステータス</label>
                <select name="status" class="form-control">
                  <option value="1">完了</option>
                  <option value="2">作業中</option>
                  <option value="3">未実装</option>
                  <!-- <option>※自分でカテゴリ追加できたらいいな※</option> -->
                </select>
              </div>
            </from>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-dismiss="modal">キャンセル</button>
            <button type="button" class="btn btn-primary" id="update-task">保存</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>

    <!-- ｊQuery特有の$はjQuery導入スクリプトより後ろに書くこと -->
    <script src="../javascripts/index.js"></script>
    <script>
      // 取得メソッド
      $(async function () {
        const data = await httpGet(
          "//" + window.location.host + "/api/tasks");
        const list = data.map((item) => {
          const d = new Date(item.deadline);//timestanp->date
          const year = d.getFullYear();
          const month = d.getMonth();
          const day = d.getDay();
          return `
          <li class="list-group-item category c${item.category_id}" name="id${item.id}">
          <div class="row align-items-center">
            <span class="col-sm-8 task">${item.task_name}</span><span class="col-sm-2 deadline">${year}年 ${month}月 ${day}日</span>  
            <div class="btn-group" role="group" aria-label="Basic example" class="col-sm-2">
              <button type="button" class="btn btn-primary update" data-toggle="modal" data-target="#update" value=${item.id}>更新</button>
              <button type="button" class="btn btn-danger">削除</button>
            </div>
          </div>
        </li>`;
        })
        $('ul#list-group').append(list);
      });

      // 登録メソッド
      $('#create-task').on("click", async function () {
        const data = {
          taskName: $("[name=task]").val(),
          deadline: $("[name=deadline]").val(),
          category: $("[name=category]").val(),
        };
        const response = await httpPost(//httpPostはjavascript/index.jsに有り
          "//" + window.location.host + "/api/tasks",
          data
        );
        console.log(response);
      });

      // 更新メソッド
      // DBから1件だけ情報取得
      $(document).on("click", ".update" , async function () {
        const i = $(this).val();
        // const data = {
        //   id: $(this).val()
        // };
        const response = await httpGet(
          "//" + window.location.host + "/api/tasks/id",
          // data
        );
        console.log(response);
        response.forEach(item => {
          console.log(item.task_name)
          if(item.id == i){
            $(document).val("#update-task", item.task_name);
          }
        })
        // $(document).val("#update.task", response.task_name);
        // $("#update.name").val(response.task_name);
        // $("#update.deadline").val(response.deadline);
        // $("#update.category").val(response.category_id);
        // $("#update.status").val(response.task_status);
      });
    </script>
  </body>
</html>